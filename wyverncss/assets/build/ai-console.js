(()=>{"use strict";var e={n:s=>{var n=s&&s.__esModule?()=>s.default:()=>s;return e.d(n,{a:n}),n},d:(s,n)=>{for(var t in n)e.o(n,t)&&!e.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:n[t]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.element,n=window.React,t=window.wp.i18n,a=window.wp.components;async function i(e,s={}){const n=function(){if(void 0===window.wyvernPressAI)throw new Error("WordPress data not found. Ensure the script is properly enqueued.");return window.wyvernPressAI}(),t=`${n.apiUrl}${e}`;try{const e=await fetch(t,{...s,headers:{"Content-Type":"application/json","X-WP-Nonce":n.nonce,...s.headers}}),a=await e.json();return e.ok?{success:!0,data:a}:{success:!1,error:a}}catch(e){return{success:!1,error:{code:"network_error",message:e instanceof Error?e.message:"Network request failed"}}}}const r={sendMessage:async e=>i("/chat/message",{method:"POST",body:JSON.stringify(e)}),getConversations:async(e=20,s=0,n="desc")=>i(`/chat/conversations?${new URLSearchParams({limit:e.toString(),offset:s.toString(),order:n})}`),createConversation:async e=>i("/chat/conversations",{method:"POST",body:JSON.stringify(e)}),getConversation:async(e,s=50)=>i(`/chat/conversations/${e}?${new URLSearchParams({limit:s.toString()})}`),deleteConversation:async e=>i(`/chat/conversations/${e}`,{method:"DELETE"}),async getHistory(e,s=50,n){const t=new URLSearchParams({limit:s.toString()});return n&&t.append("before",n.toString()),i(`/chat/history/${e}?${t}`)}},l=async()=>i("/settings"),o=async e=>i("/settings/openrouter-key",{method:"POST",body:JSON.stringify({api_key:e})}),c=async()=>i("/settings/openrouter-key",{method:"DELETE"}),d=async e=>i("/settings/verify-key",{method:"POST",body:JSON.stringify({api_key:e})}),y=async e=>i("/settings/preferences",{method:"POST",body:JSON.stringify(e)}),h=async()=>i("/settings/models");function u(){const[e,n]=(0,s.useState)(null),[t,a]=(0,s.useState)([]),[i,r]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),g=(0,s.useCallback)(async()=>{r(!0),m(null);try{const e=await l();e.success&&e.data?n(e.data):m(e.error?.message||"Failed to load settings")}catch(e){m(e instanceof Error?e.message:"Unknown error")}finally{r(!1)}},[]),v=(0,s.useCallback)(async()=>{r(!0),m(null);try{const e=await h();e.success&&e.data?a(e.data.models):m(e.error?.message||"Failed to load models")}catch(e){m(e instanceof Error?e.message:"Unknown error")}finally{r(!1)}},[]),x=(0,s.useCallback)(async e=>{r(!0),m(null);try{const s=await o(e);return s.success?(await g(),!0):(m(s.error?.message||"Failed to save API key"),!1)}catch(e){return m(e instanceof Error?e.message:"Unknown error"),!1}finally{r(!1)}},[g]),_=(0,s.useCallback)(async e=>{r(!0),m(null);try{const s=await d(e);return!(!s.success||!s.data?.valid)||(m(s.data?.message||"API key verification failed"),!1)}catch(e){return m(e instanceof Error?e.message:"Unknown error"),!1}finally{r(!1)}},[]),j=(0,s.useCallback)(async()=>{r(!0),m(null);try{const e=await c();return e.success?(await g(),!0):(m(e.error?.message||"Failed to delete API key"),!1)}catch(e){return m(e instanceof Error?e.message:"Unknown error"),!1}finally{r(!1)}},[g]),w=(0,s.useCallback)(async e=>{r(!0),m(null);try{const s=await y(e);return s.success?(await g(),!0):(m(s.error?.message||"Failed to save preferences"),!1)}catch(e){return m(e instanceof Error?e.message:"Unknown error"),!1}finally{r(!1)}},[g]);return(0,s.useEffect)(()=>{g()},[g]),{settings:e,models:t,isLoading:i,error:u,hasApiKey:e?.has_api_key||!1,saveApiKey:x,verifyApiKey:_,deleteApiKey:j,savePreferences:w,loadSettings:g,loadModels:v}}function m(){const[e,n]=(0,s.useState)([]),[t,a]=(0,s.useState)(null),[i,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{l(!0),c(null);try{const e=await r.getConversations(50,0,"desc");e.success&&e.data?(n(e.data.conversations),!t&&e.data.conversations.length>0&&a(e.data.conversations[0].id)):c(e.error?.message||"Failed to load conversations")}catch(e){c(e instanceof Error?e.message:"Unknown error")}finally{l(!1)}},[t]),y=(0,s.useCallback)(async e=>{l(!0),c(null);try{const s=await r.createConversation(e);return s.success&&s.data?(await d(),a(s.data.id),s.data.id):(c(s.error?.message||"Failed to create conversation"),null)}catch(e){return c(e instanceof Error?e.message:"Unknown error"),null}finally{l(!1)}},[d]),h=(0,s.useCallback)(async s=>{l(!0),c(null);try{const n=await r.deleteConversation(s);if(n.success){if(t===s){const n=e.filter(e=>e.id!==s);a(n.length>0?n[0].id:null)}return await d(),!0}return c(n.error?.message||"Failed to delete conversation"),!1}catch(e){return c(e instanceof Error?e.message:"Unknown error"),!1}finally{l(!1)}},[t,e,d]),u=(0,s.useCallback)(e=>{a(e)},[]),m=(0,s.useCallback)(async()=>{if(t){l(!0),c(null);try{const e=await r.getConversation(t);e.success&&e.data?n(s=>s.map(s=>s.id===t?{...s,updated_at:e.data.updated_at}:s)):c(e.error?.message||"Failed to refresh conversation")}catch(e){c(e instanceof Error?e.message:"Unknown error")}finally{l(!1)}}},[t]);return(0,s.useEffect)(()=>{d()},[d]),{conversations:e,currentConversationId:t,isLoading:i,error:o,createConversation:y,deleteConversation:h,selectConversation:u,loadConversations:d,refreshCurrent:m}}const g=window.ReactJSXRuntime;function v({toolCall:e,showDetails:s=!0}){const{tool:n,arguments:a,result:i,success:r,execution_time_ms:l,error:o}=e;return(0,g.jsxs)("div",{className:"tool-execution "+(r?"tool-success":"tool-error"),role:"region","aria-label":(0,t.__)("Tool execution result","wyvern-ai-styling"),children:[(0,g.jsxs)("div",{className:"tool-header",children:[(0,g.jsx)("span",{className:"tool-icon","aria-hidden":"true",children:r?"âœ“":"âœ—"}),(0,g.jsx)("span",{className:"tool-name",children:n}),(0,g.jsxs)("span",{className:"tool-time",children:[l,"ms"]})]}),s&&(0,g.jsxs)(g.Fragment,{children:[Object.keys(a).length>0&&(0,g.jsxs)("details",{className:"tool-details",children:[(0,g.jsx)("summary",{children:(0,t.__)("Arguments","wyvern-ai-styling")}),(0,g.jsx)("pre",{children:(0,g.jsx)("code",{children:JSON.stringify(a,null,2)})})]}),i&&(0,g.jsxs)("details",{className:"tool-details",children:[(0,g.jsx)("summary",{children:(0,t.__)("Result","wyvern-ai-styling")}),(0,g.jsx)("pre",{children:(0,g.jsx)("code",{children:JSON.stringify(i,null,2)})})]}),o&&(0,g.jsxs)("div",{className:"tool-error-message",role:"alert",children:[(0,g.jsx)("strong",{children:(0,t.__)("Error:","wyvern-ai-styling")})," ",o]})]})]})}function x(e){try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return""}}function _({message:e,showToolExecutions:s=!0}){const{role:n,content:a,tool_calls:i,tokens_used:r,cost_usd:l,created_at:o}=e;return(0,g.jsxs)("div",{className:`message-bubble message-${n}`,role:"article","aria-label":`${n} message`,children:[(0,g.jsxs)("div",{className:"message-header",children:[(0,g.jsx)("span",{className:"message-role",children:"user"===n?(0,t.__)("You","wyvern-ai-styling"):(0,t.__)("AI Assistant","wyvern-ai-styling")}),(0,g.jsx)("span",{className:"message-time",children:x(o)})]}),(0,g.jsx)("div",{className:"message-content",children:(0,g.jsx)("p",{children:a})}),s&&i&&i.length>0&&(0,g.jsxs)("div",{className:"message-tools",children:[(0,g.jsx)("div",{className:"tools-header",children:(0,t.__)("Actions Performed:","wyvern-ai-styling")}),i.map((e,s)=>(0,g.jsx)(v,{toolCall:e,showDetails:!0},`${e.tool}-${s}`))]}),"assistant"===n&&(r||void 0!==l)&&(0,g.jsxs)("div",{className:"message-meta",children:[r&&(0,g.jsxs)("span",{className:"meta-tokens",children:[r," ",(0,t.__)("tokens","wyvern-ai-styling")]}),void 0!==l&&(0,g.jsxs)("span",{className:"meta-cost",children:["$",l.toFixed(4)]})]})]})}function j({messages:e,isLoading:n=!1,showToolExecutions:a=!0}){const i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{i.current?.scrollIntoView({behavior:"smooth"})},[e]),0!==e.length||n?(0,g.jsxs)("div",{className:"message-list",role:"log","aria-label":(0,t.__)("Chat messages","wyvern-ai-styling"),"aria-live":"polite",children:[e.map(e=>(0,g.jsx)(_,{message:e,showToolExecutions:a},e.id)),n&&(0,g.jsxs)("div",{className:"message-bubble message-loading",role:"status",children:[(0,g.jsxs)("div",{className:"loading-indicator",children:[(0,g.jsx)("span",{className:"loading-dot"}),(0,g.jsx)("span",{className:"loading-dot"}),(0,g.jsx)("span",{className:"loading-dot"})]}),(0,g.jsx)("span",{className:"sr-only",children:(0,t.__)("AI is thinkingâ€¦","wyvern-ai-styling")})]}),(0,g.jsx)("div",{ref:i})]}):(0,g.jsx)("div",{className:"message-list-empty",role:"status",children:(0,g.jsxs)("div",{className:"empty-state",children:[(0,g.jsx)("div",{className:"empty-icon","aria-hidden":"true",children:"ðŸ’¬"}),(0,g.jsx)("h3",{children:(0,t.__)("Start a Conversation","wyvern-ai-styling")}),(0,g.jsx)("p",{children:(0,t.__)("Ask me anything about your WordPress site. I can help you create content, manage posts, configure settings, and more!","wyvern-ai-styling")})]})})}function w({onSend:e,disabled:n=!1,placeholder:i=(0,t.__)("Ask me anything about your WordPress siteâ€¦","wyvern-ai-styling")}){const[r,l]=(0,s.useState)(""),o=(0,s.useRef)(null),c=()=>{const s=r.trim();s&&!n&&(e(s),l(""),o.current?.focus())};return(0,g.jsxs)("div",{className:"message-input-container",children:[(0,g.jsxs)("div",{className:"message-input-wrapper",children:[(0,g.jsx)("textarea",{ref:o,className:"message-input",value:r,onChange:e=>{const s=e.target;l(s.value),s.style.height="auto",s.style.height=`${Math.min(s.scrollHeight,200)}px`},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:i,disabled:n,rows:1,"aria-label":(0,t.__)("Message input","wyvern-ai-styling"),"aria-describedby":"message-input-help"}),(0,g.jsx)(a.Button,{variant:"primary",className:"message-send-button",onClick:c,disabled:n||!r.trim(),"aria-label":(0,t.__)("Send message","wyvern-ai-styling"),children:(0,t.__)("Send","wyvern-ai-styling")})]}),(0,g.jsx)("div",{id:"message-input-help",className:"message-input-help",children:(0,t.__)("Press Enter to send, Shift+Enter for new line","wyvern-ai-styling")})]})}function p({conversationId:e,showToolExecutions:n=!0}){const{messages:i,isLoading:l,isSending:o,error:c,sendMessage:d}=function(e){const[n,a]=(0,s.useState)([]),[i,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),[d,y]=(0,s.useState)(null),h=(0,s.useCallback)(async()=>{if(e){l(!0),y(null);try{const s=await r.getHistory(e,100);s.success&&s.data?a(s.data.messages):y(s.error?.message||(0,t.__)("Failed to load message history","wyvern-ai-styling"))}catch(e){y(e instanceof Error?e.message:(0,t.__)("Unknown error","wyvern-ai-styling"))}finally{l(!1)}}else a([])},[e]),u=(0,s.useCallback)(async(s,n)=>{if(!e)return y((0,t.__)("No conversation selected","wyvern-ai-styling")),!1;if(!s.trim())return y((0,t.__)("Message cannot be empty","wyvern-ai-styling")),!1;c(!0),y(null);const i={id:Date.now(),conversation_id:e,role:"user",content:s.trim(),created_at:(new Date).toISOString()};a(e=>[...e,i]);try{const l={conversation_id:e,message:s.trim(),model:n},o=await r.sendMessage(l);if(o.success&&o.data){const s={id:o.data.message_id,conversation_id:e,role:"assistant",content:o.data.message,tool_calls:o.data.tool_calls,tokens_used:o.data.usage.total_tokens,cost_usd:o.data.usage.estimated_cost,created_at:(new Date).toISOString()};return a(e=>[...e.filter(e=>e.id!==i.id),{...i,id:o.data.message_id-1},s]),!0}return a(e=>e.filter(e=>e.id!==i.id)),y(o.error?.message||(0,t.__)("Failed to send message","wyvern-ai-styling")),!1}catch(e){return a(e=>e.filter(e=>e.id!==i.id)),y(e instanceof Error?e.message:(0,t.__)("Unknown error","wyvern-ai-styling")),!1}finally{c(!1)}},[e]),m=(0,s.useCallback)(()=>{a([])},[]);return(0,s.useEffect)(()=>{h()},[e,h]),{messages:n,isLoading:i,isSending:o,error:d,sendMessage:u,loadHistory:h,clearMessages:m}}(e),{createConversation:y}=m(),h=async s=>{if(e)await d(s);else{const e=s.substring(0,50)+(s.length>50?"...":"");if(!await y({title:e}))return;setTimeout(async()=>{await d(s)},100)}};return e?(0,g.jsxs)("div",{className:"chat-interface",children:[c&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:c}),(0,g.jsx)(j,{messages:i,isLoading:o,showToolExecutions:n}),(0,g.jsx)(w,{onSend:h,disabled:o||l})]}):(0,g.jsxs)("div",{className:"chat-interface-empty",children:[(0,g.jsxs)("div",{className:"empty-state",children:[(0,g.jsx)("div",{className:"empty-icon","aria-hidden":"true",children:"ðŸ‘‹"}),(0,g.jsx)("h2",{children:(0,t.__)("How can I help you today?","wyvern-ai-styling")}),(0,g.jsx)("p",{children:(0,t.__)("I can help you create and manage WordPress content, answer questions about your site, and more. Just start typing below to begin!","wyvern-ai-styling")})]}),(0,g.jsx)(w,{onSend:h,disabled:o||l,placeholder:(0,t.__)("Ask me anything about WordPressâ€¦","wyvern-ai-styling")})]})}const f=window.wp.apiFetch;var b=e.n(f);function N(){const[e,n]=(0,s.useState)({status:"checking",toolsCount:0,tools:[]});return(0,s.useEffect)(()=>{const e=async()=>{try{const e=await b()({path:"/wyverncss/v1/mcp/status",method:"GET"});n({status:e.status,source:e.source,toolsCount:e.tools_count,tools:e.tools,message:e.message})}catch(e){n({status:"offline",toolsCount:0,tools:[],error:e instanceof Error?e.message:(0,t.__)("Failed to check MCP server status","wyvern-ai-styling")})}};e();const s=setInterval(e,3e4);return()=>clearInterval(s)},[]),(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("MCP Server Status","wyvern-ai-styling"),initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsxs)("div",{className:"mcp-status-container",children:[(0,g.jsxs)("div",{className:"mcp-status-header",children:[(0,g.jsxs)("div",{className:"mcp-status-indicator",children:["checking"===e.status&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Spinner,{}),(0,g.jsx)("span",{children:(0,t.__)("Checkingâ€¦","wyvern-ai-styling")})]}),"online"===e.status&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{className:"status-dot status-online","aria-hidden":"true",children:"â—"}),(0,g.jsx)("strong",{style:{color:"#00a32a"},children:(0,t.__)("Online","wyvern-ai-styling")})]}),"offline"===e.status&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{className:"status-dot status-offline","aria-hidden":"true",children:"â—"}),(0,g.jsx)("strong",{style:{color:"#cc1818"},children:(0,t.__)("Offline","wyvern-ai-styling")})]})]}),e.source&&(0,g.jsx)("div",{className:"mcp-source",style:{marginTop:"4px"},children:(0,g.jsxs)("small",{style:{color:"#757575"},children:[(0,t.__)("Source:","wyvern-ai-styling")," ",e.source," (",e.toolsCount," ",1===e.toolsCount?(0,t.__)("tool","wyvern-ai-styling"):(0,t.__)("tools","wyvern-ai-styling"),")"]})})]}),e.message&&"online"===e.status&&(0,g.jsx)("div",{className:"mcp-message",style:{marginTop:"8px"},children:(0,g.jsx)("small",{style:{color:"#757575"},children:e.message})}),e.error&&(0,g.jsx)("div",{className:"mcp-error",style:{marginTop:"8px",color:"#cc1818"},children:(0,g.jsx)("small",{children:e.error})}),"online"===e.status&&e.tools.length>0&&(0,g.jsxs)("div",{className:"mcp-tools",style:{marginTop:"16px"},children:[(0,g.jsx)("h4",{children:(0,t.__)("Available Tools","wyvern-ai-styling")}),(0,g.jsx)("ul",{className:"mcp-tools-list",style:{marginLeft:0,paddingLeft:0,listStyle:"none"},children:e.tools.map(e=>(0,g.jsx)("li",{className:"mcp-tool-item",style:{padding:"8px 0",borderBottom:"1px solid #ddd"},children:(0,g.jsx)("code",{style:{fontWeight:"bold"},children:e})},e))})]})]})})})})}function P(){const{settings:e,error:n,isLoading:i,hasApiKey:r,saveApiKey:l,verifyApiKey:o,deleteApiKey:c,savePreferences:d}=u(),[y,h]=(0,s.useState)(""),[m,v]=(0,s.useState)(null),[x,_]=(0,s.useState)(null),[j,w]=(0,s.useState)(!1),p=async(s,n)=>{e&&await d({...e.preferences,[s]:n})};return(0,g.jsxs)("div",{className:"settings-panel",children:[(0,g.jsx)("h2",{children:(0,t.__)("WyvernCSS AI Settings","wyvern-ai-styling")}),n&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:n}),(0,g.jsx)(N,{}),(0,g.jsxs)(a.Panel,{children:[(0,g.jsxs)(a.PanelBody,{title:(0,t.__)("API Configuration","wyvern-ai-styling"),initialOpen:!0,children:[(0,g.jsxs)("p",{className:"description",children:[(0,t.__)("Enter your OpenRouter API key to enable AI-powered features. Get your key from","wyvern-ai-styling")," ",(0,g.jsx)("a",{href:"https://openrouter.ai/keys",target:"_blank",rel:"noopener noreferrer",children:"openrouter.ai/keys"})]}),m&&(0,g.jsx)(a.Notice,{status:"error",isDismissible:!0,onDismiss:()=>v(null),children:m}),x&&(0,g.jsx)(a.Notice,{status:"success",isDismissible:!0,onDismiss:()=>_(null),children:x}),r?(0,g.jsxs)("div",{className:"api-key-configured",children:[(0,g.jsx)(a.PanelRow,{children:(0,g.jsxs)("div",{className:"api-key-status",children:[(0,g.jsx)("span",{className:"dashicons dashicons-yes-alt",style:{color:"#00a32a"}}),(0,g.jsx)("span",{children:(0,t.__)("API key is configured","wyvern-ai-styling")})]})}),(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.Button,{variant:"secondary",isDestructive:!0,onClick:async()=>{v(null),_(null),await c()?_((0,t.__)("API key removed successfully.","wyvern-ai-styling")):v((0,t.__)("Failed to remove API key.","wyvern-ai-styling"))},disabled:i,children:(0,t.__)("Remove API Key","wyvern-ai-styling")})})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.TextControl,{label:(0,t.__)("OpenRouter API Key","wyvern-ai-styling"),value:y,onChange:h,placeholder:"sk-or-v1-...",type:"password",help:(0,t.__)("Your API key is encrypted and stored securely.","wyvern-ai-styling")})}),(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.Button,{variant:"primary",onClick:async()=>{v(null),_(null),w(!0);try{if(!y.startsWith("sk-or-v1-"))return void v((0,t.__)('Invalid API key format. OpenRouter keys start with "sk-or-v1-"',"wyvern-ai-styling"));if(!await o(y))return void v((0,t.__)("API key verification failed. Please check your key.","wyvern-ai-styling"));await l(y)?(_((0,t.__)("API key saved successfully!","wyvern-ai-styling")),h("")):v((0,t.__)("Failed to save API key.","wyvern-ai-styling"))}finally{w(!1)}},disabled:!y||j,children:j?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Spinner,{}),(0,t.__)("Verifyingâ€¦","wyvern-ai-styling")]}):(0,t.__)("Save API Key","wyvern-ai-styling")})})]})]}),e&&(0,g.jsxs)(a.PanelBody,{title:(0,t.__)("Preferences","wyvern-ai-styling"),initialOpen:!1,children:[(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.ToggleControl,{label:(0,t.__)("Show Tool Executions","wyvern-ai-styling"),checked:e.preferences.show_tool_executions,onChange:e=>p("show_tool_executions",e),help:(0,t.__)("Display detailed information about AI actions","wyvern-ai-styling")})}),(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.ToggleControl,{label:(0,t.__)("Auto-save Conversations","wyvern-ai-styling"),checked:e.preferences.auto_save_conversations,onChange:e=>p("auto_save_conversations",e),help:(0,t.__)("Automatically save conversation history","wyvern-ai-styling")})}),(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)(a.TextControl,{label:(0,t.__)("Max Context Messages","wyvern-ai-styling"),type:"number",value:(e.preferences.max_context_messages||20).toString(),onChange:e=>p("max_context_messages",parseInt(e,10)),min:5,max:50,help:(0,t.__)("Number of recent messages to include in AI context","wyvern-ai-styling")})})]}),e?.usage_summary&&(0,g.jsx)(a.PanelBody,{title:(0,t.__)("Usage Summary","wyvern-ai-styling"),initialOpen:!1,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsxs)("div",{className:"usage-summary",children:[(0,g.jsxs)("div",{className:"usage-stat",children:[(0,g.jsx)("strong",{children:(0,t.__)("Total Conversations:","wyvern-ai-styling")})," ",e.usage_summary.total_conversations]}),(0,g.jsxs)("div",{className:"usage-stat",children:[(0,g.jsx)("strong",{children:(0,t.__)("Total Messages:","wyvern-ai-styling")})," ",e.usage_summary.total_messages]}),(0,g.jsxs)("div",{className:"usage-stat",children:[(0,g.jsx)("strong",{children:(0,t.__)("Cost This Month:","wyvern-ai-styling")})," $",e.usage_summary.total_cost_month.toFixed(2)]}),(0,g.jsxs)("div",{className:"usage-stat",children:[(0,g.jsx)("strong",{children:(0,t.__)("Requests Today:","wyvern-ai-styling")})," ",e.usage_summary.requests_today]})]})})})]})]})}function S(){const[e,s]=(0,n.useState)(null),[i,r]=(0,n.useState)(!0),[l,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),y=async()=>{try{d(!0);const e=await b()({path:"/wyverncss/v1/debug",method:"GET"});s(e),o(null)}catch(e){o(e instanceof Error?e.message:(0,t.__)("Failed to fetch debug information","wyvern-ai-styling"))}finally{r(!1),d(!1)}};if((0,n.useEffect)(()=>{y()},[]),i)return(0,g.jsxs)("div",{className:"debug-panel-loading",children:[(0,g.jsx)(a.Spinner,{}),(0,g.jsx)("p",{children:(0,t.__)("Loading debug informationâ€¦","wyvern-ai-styling")})]});if(l)return(0,g.jsx)("div",{className:"debug-panel-error",children:(0,g.jsx)(a.Notice,{status:"error",isDismissible:!1,children:l})});if(!e)return null;const h=[{name:"system",title:(0,t.__)("System","wyvern-ai-styling"),className:"debug-tab-system"},{name:"mcp",title:(0,t.__)("MCP Tools","wyvern-ai-styling"),className:"debug-tab-mcp"},{name:"permissions",title:(0,t.__)("Permissions","wyvern-ai-styling"),className:"debug-tab-permissions"},{name:"rest_api",title:(0,t.__)("REST API","wyvern-ai-styling"),className:"debug-tab-rest-api"},{name:"errors",title:(0,t.__)("Errors","wyvern-ai-styling"),className:"debug-tab-errors"},{name:"constants",title:(0,t.__)("Constants","wyvern-ai-styling"),className:"debug-tab-constants"}];return(0,g.jsxs)("div",{className:"debug-panel",children:[(0,g.jsxs)("div",{className:"debug-panel-header",children:[(0,g.jsx)("h2",{children:(0,t.__)("WyvernCSS Debug Information","wyvern-ai-styling")}),(0,g.jsx)("button",{className:"button button-secondary",onClick:y,disabled:c,children:c?(0,t.__)("Refreshingâ€¦","wyvern-ai-styling"):(0,t.__)("Refresh","wyvern-ai-styling")})]}),(0,g.jsx)(a.TabPanel,{className:"debug-tabs",activeClass:"is-active",tabs:h,children:s=>(0,g.jsxs)(g.Fragment,{children:["system"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("System Information","wyvern-ai-styling"),initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsxs)("div",{className:"debug-info-grid",children:[(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("PHP Version:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.php_version})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("WordPress Version:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.wordpress_version})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("Plugin Version:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.plugin_version})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("Memory Limit:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.memory_limit})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("Max Execution Time:","wyvern-ai-styling")}),(0,g.jsxs)("code",{children:[e.system.max_execution_time,"s"]})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("WP_DEBUG:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.wp_debug?"true":"false"})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("WP_DEBUG_LOG:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.wp_debug_log?"true":"false"})]}),(0,g.jsxs)("div",{className:"debug-info-item",children:[(0,g.jsx)("strong",{children:(0,t.__)("Active Theme:","wyvern-ai-styling")}),(0,g.jsx)("code",{children:e.system.active_theme})]})]})})})}),"mcp"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("MCP Tools","wyvern-ai-styling")+` (${e.mcp.tools_count})`,initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)("div",{className:"debug-tools-list",children:0===e.mcp.tools.length?(0,g.jsx)(a.Notice,{status:"warning",isDismissible:!1,children:(0,t.__)("No MCP tools discovered. Check file permissions.","wyvern-ai-styling")}):(0,g.jsxs)("table",{className:"widefat striped",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:(0,t.__)("Tool Name","wyvern-ai-styling")}),(0,g.jsx)("th",{children:(0,t.__)("Description","wyvern-ai-styling")}),(0,g.jsx)("th",{children:(0,t.__)("Class","wyvern-ai-styling")})]})}),(0,g.jsx)("tbody",{children:e.mcp.tools.map((e,s)=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:e.name})}),(0,g.jsx)("td",{children:e.description}),(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:e.class})})]},s))})]})})})})}),"permissions"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("File Permissions","wyvern-ai-styling"),initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)("div",{className:"debug-permissions-list",children:0===Object.keys(e.permissions).length?(0,g.jsx)(a.Notice,{status:"info",isDismissible:!1,children:(0,t.__)("No permission issues detected.","wyvern-ai-styling")}):(0,g.jsxs)("table",{className:"widefat striped",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:(0,t.__)("File","wyvern-ai-styling")}),(0,g.jsx)("th",{children:(0,t.__)("Readable","wyvern-ai-styling")}),(0,g.jsx)("th",{children:(0,t.__)("Permissions","wyvern-ai-styling")})]})}),(0,g.jsx)("tbody",{children:Object.entries(e.permissions).map(([e,s],n)=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:e})}),(0,g.jsx)("td",{children:(0,g.jsx)("span",{className:s.readable?"status-ok":"status-error",children:s.readable?"âœ“":"âœ—"})}),(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:s.permissions})})]},n))})]})})})})}),"rest_api"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("REST API Routes","wyvern-ai-styling")+` (${e.rest_api.count})`,initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)("div",{className:"debug-routes-list",children:(0,g.jsx)("ul",{children:e.rest_api.routes.map((e,s)=>(0,g.jsx)("li",{children:(0,g.jsx)("code",{children:e})},s))})})})})}),"errors"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("Recent Errors","wyvern-ai-styling"),initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)("div",{className:"debug-errors-list",children:0===e.errors.length?(0,g.jsx)(a.Notice,{status:"success",isDismissible:!1,children:(0,t.__)("No recent errors found.","wyvern-ai-styling")}):(0,g.jsx)("div",{className:"error-log",children:e.errors.map((e,s)=>(0,g.jsx)("pre",{className:"error-line",children:e},s))})})})})}),"constants"===s.name&&(0,g.jsx)(a.Panel,{children:(0,g.jsx)(a.PanelBody,{title:(0,t.__)("WordPress Constants","wyvern-ai-styling"),initialOpen:!0,children:(0,g.jsx)(a.PanelRow,{children:(0,g.jsx)("div",{className:"debug-constants-list",children:(0,g.jsxs)("table",{className:"widefat striped",children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:(0,t.__)("Constant","wyvern-ai-styling")}),(0,g.jsx)("th",{children:(0,t.__)("Value","wyvern-ai-styling")})]})}),(0,g.jsx)("tbody",{children:Object.entries(e.constants).map(([e,s],n)=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:e})}),(0,g.jsx)("td",{children:(0,g.jsx)("code",{children:String(s)})})]},n))})]})})})})})]})})]})}function k(e){try{const s=new Date(e),n=(new Date).getTime()-s.getTime(),a=Math.floor(n/6e4),i=Math.floor(n/36e5),r=Math.floor(n/864e5);return a<1?(0,t.__)("Just now","wyvern-ai-styling"):a<60?`${a}m ago`:i<24?`${i}h ago`:r<7?`${r}d ago`:s.toLocaleDateString()}catch{return""}}function C({conversation:e,isActive:s,onSelect:n,onDelete:i}){const{id:r,title:l,message_count:o,updated_at:c,total_cost:d}=e;return(0,g.jsxs)("div",{className:"conversation-item "+(s?"conversation-active":""),onClick:()=>n(r),role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n(r))},"aria-label":`${l} - ${o} messages`,"aria-current":s?"true":void 0,children:[(0,g.jsxs)("div",{className:"conversation-header",children:[(0,g.jsx)("h3",{className:"conversation-title",children:l}),(0,g.jsx)(a.Button,{icon:"trash",label:(0,t.__)("Delete conversation","wyvern-ai-styling"),onClick:e=>{e.stopPropagation();const s=(0,t.__)("Delete conversation","wyvern-ai-styling");confirm(`${s} "${l}"?`)&&i(r)},className:"conversation-delete",isSmall:!0})]}),(0,g.jsxs)("div",{className:"conversation-meta",children:[(0,g.jsxs)("span",{className:"conversation-messages",children:[o," ",1===o?(0,t.__)("message","wyvern-ai-styling"):(0,t.__)("messages","wyvern-ai-styling")]}),(0,g.jsx)("span",{className:"conversation-separator",children:"â€¢"}),(0,g.jsx)("span",{className:"conversation-time",children:k(c)})]}),void 0!==d&&d>0&&(0,g.jsxs)("div",{className:"conversation-cost",children:["$",d.toFixed(4)]})]})}function E({onConversationChange:e}){const{conversations:s,currentConversationId:n,error:a,deleteConversation:i,selectConversation:r}=m(),l=s=>{r(s),e?.(s)},o=async s=>{await i(s)&&e?.(n)};return(0,g.jsxs)("div",{className:"conversation-list",children:[(0,g.jsx)("div",{className:"conversation-list-header",children:(0,g.jsx)("h2",{children:(0,t.__)("Conversations","wyvern-ai-styling")})}),a&&(0,g.jsx)("div",{className:"conversation-error",role:"alert",children:a}),0===s.length?(0,g.jsx)("div",{className:"conversation-list-empty",children:(0,g.jsx)("p",{children:(0,t.__)("No conversations yet. Start chatting to create your first conversation!","wyvern-ai-styling")})}):(0,g.jsx)("div",{className:"conversation-list-items",role:"list",children:s.map(e=>(0,g.jsx)(C,{conversation:e,isActive:e.id===n,onSelect:l,onDelete:o},e.id))})]})}function A(){const e=new URLSearchParams(window.location.search).get("view");return"settings"===e||"debug"===e||"chat"===e?e:"chat"}function I(){var e;const{settings:s}=u(),{currentConversationId:i}=m(),[r,l]=(0,n.useState)(A),o=e=>{l(e),function(e){const s=new URLSearchParams(window.location.search);s.set("view",e);const n=`${window.location.pathname}?${s.toString()}`;window.history.pushState({view:e},"",n)}(e)};return(0,n.useEffect)(()=>{const e=e=>{e.state?.view?l(e.state.view):l(A())};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]),(0,g.jsxs)("div",{className:"wyverncss-admin-console",children:[(0,g.jsxs)("header",{className:"wyverncss-header",children:[(0,g.jsxs)("div",{className:"header-left",children:[(0,g.jsx)("h1",{children:(0,t.__)("WyvernCSS AI Console","wyvern-ai-styling")}),(0,g.jsx)("span",{className:"header-subtitle",children:(0,t.__)("AI-powered WordPress management","wyvern-ai-styling")})]}),(0,g.jsx)("div",{className:"header-right",children:(0,g.jsxs)(a.ButtonGroup,{children:[(0,g.jsx)(a.Button,{variant:"chat"===r?"primary":"secondary",onClick:()=>o("chat"),"aria-pressed":"chat"===r,children:(0,t.__)("Chat","wyvern-ai-styling")}),(0,g.jsx)(a.Button,{variant:"settings"===r?"primary":"secondary",onClick:()=>o("settings"),"aria-pressed":"settings"===r,children:(0,t.__)("Settings","wyvern-ai-styling")}),(0,g.jsx)(a.Button,{variant:"debug"===r?"primary":"secondary",onClick:()=>o("debug"),"aria-pressed":"debug"===r,children:(0,t.__)("Debug","wyvern-ai-styling")})]})})]}),(0,g.jsxs)("div",{className:"wyverncss-main",children:["chat"===r&&(0,g.jsx)("aside",{className:"wyverncss-sidebar",children:(0,g.jsx)(E,{})}),(0,g.jsxs)("main",{className:"wyverncss-content "+("chat"!==r?"wyverncss-content-full":""),role:"main",children:["settings"===r&&(0,g.jsx)(P,{}),"debug"===r&&(0,g.jsx)(S,{}),"chat"===r&&(0,g.jsx)(p,{conversationId:i,showToolExecutions:null===(e=s?.preferences.show_tool_executions)||void 0===e||e})]})]})]})}function T(){const e=document.getElementById("wyverncss-admin-root");e&&(void 0!==window.wyvernPressAI?(0,s.render)((0,g.jsx)(I,{}),e):e.innerHTML='\n\t\t\t<div class="notice notice-error">\n\t\t\t\t<p>WyvernCSS AI Console failed to load: WordPress data not found.</p>\n\t\t\t</div>\n\t\t')}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",T):T()})();