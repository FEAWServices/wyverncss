(()=>{"use strict";const e=window.wp.blocks,s=window.wp.i18n,t=window.React,n=window.wp.blockEditor,r=window.wp.components,i=window.ReactJSXRuntime,a=({isOpen:e,onClick:t,theme:n})=>(0,i.jsx)("button",{type:"button",className:`wyverncss-chat-bubble wyverncss-chat-bubble--${n}`,onClick:t,"aria-label":e?(0,s.__)("Close chat","wyverncss"):(0,s.__)("Open chat","wyverncss"),"aria-expanded":e,children:e?(0,i.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,i.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}):(0,i.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,i.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),o=({onSend:e,disabled:n,placeholder:r=(0,s.__)("Type your message…","wyverncss"),theme:a})=>{const[o,c]=(0,t.useState)(""),l=(0,t.useCallback)(()=>{o.trim()&&!n&&(e(o.trim()),c(""))},[o,n,e]),d=(0,t.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l())},[l]),h=0===o.trim().length;return(0,i.jsxs)("div",{className:`wyverncss-chat-input wyverncss-chat-input--${a}`,children:[(0,i.jsx)("label",{htmlFor:"wyverncss-message-input",className:"wyverncss-chat-input__label",children:(0,s.__)("Message","wyverncss")}),(0,i.jsxs)("div",{className:"wyverncss-chat-input__wrapper",children:[(0,i.jsx)("textarea",{id:"wyverncss-message-input",className:"wyverncss-chat-input__field",value:o,onChange:e=>c(e.target.value),onKeyPress:d,placeholder:r,disabled:n,"aria-label":(0,s.__)("Message","wyverncss"),rows:1}),(0,i.jsxs)("button",{type:"button",className:"wyverncss-chat-input__button",onClick:l,disabled:n||h,"aria-label":(0,s.__)("Send message","wyverncss"),children:[(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),(0,i.jsx)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),(0,i.jsx)("span",{className:"wyverncss-chat-input__button-text",children:(0,s.__)("Send","wyverncss")})]})]})]})},c=({message:e,theme:t})=>{const n="user"===e.role,r=!0===e.error;return(0,i.jsxs)("div",{className:`wyverncss-message wyverncss-message--${e.role} wyverncss-message--${t}${r?" wyverncss-message--error":""}`,role:"article","aria-label":n?(0,s.__)("Your message","wyverncss"):(0,s.__)("Assistant message","wyverncss"),children:[(0,i.jsx)("div",{className:"wyverncss-message__avatar","aria-hidden":"true",children:n?(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,i.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}):(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,i.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),(0,i.jsxs)("div",{className:"wyverncss-message__content",children:[(0,i.jsx)("p",{className:"wyverncss-message__text",children:e.content}),(0,i.jsx)("time",{className:"wyverncss-message__timestamp",dateTime:e.timestamp.toISOString(),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},l=({theme:e})=>(0,i.jsxs)("div",{className:`wyverncss-typing-indicator wyverncss-typing-indicator--${e}`,role:"status","aria-live":"polite",children:[(0,i.jsx)("div",{className:"wyverncss-typing-indicator__avatar","aria-hidden":"true",children:(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,i.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),(0,i.jsxs)("div",{className:"wyverncss-typing-indicator__content",children:[(0,i.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,i.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,i.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,i.jsx)("span",{className:"wyverncss-sr-only",children:(0,s.__)("Assistant is typing","wyverncss")})]})]}),d=({messages:e,isLoading:n,theme:r})=>{const a=(0,t.useRef)(null);return(0,t.useEffect)(()=>{a.current&&"function"==typeof a.current.scrollIntoView&&a.current.scrollIntoView({behavior:"smooth"})},[e,n]),(0,i.jsx)("div",{className:`wyverncss-message-list wyverncss-message-list--${r}`,children:0!==e.length||n?(0,i.jsxs)(i.Fragment,{children:[e.map(e=>(0,i.jsx)(c,{message:e,theme:r},e.id)),n&&(0,i.jsx)(l,{theme:r}),(0,i.jsx)("div",{ref:a,"aria-hidden":"true"})]}):(0,i.jsx)("div",{className:"wyverncss-message-list__empty",role:"status","aria-live":"polite",children:(0,i.jsx)("p",{children:(0,s.__)("Start a conversation by typing a message below.","wyverncss")})})})},h=({botId:e,position:n,theme:r,width:c="400px",height:l="500px",placeholder:h=(0,s.__)("Type your message…","wyverncss"),welcomeMessage:w})=>{const[y,v]=(0,t.useState)("inline"===n),[p,g]=(0,t.useState)([]),[x,m]=(0,t.useState)(!1),u=(0,t.useRef)(void 0);(0,t.useEffect)(()=>{if(w&&0===p.length){const e={id:`welcome-${Date.now()}`,role:"assistant",content:w,timestamp:new Date};g([e])}},[w,p.length]);const _=(0,t.useCallback)(()=>{v(e=>!e)},[]),j=(0,t.useCallback)(async t=>{const n={id:`user-${Date.now()}`,role:"user",content:t,timestamp:new Date};g(e=>[...e,n]),m(!0);try{const n={message:t,botId:e,conversationId:u.current},r=await fetch("/wp-json/wyverncss/v1/chat",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wyverncssApiSettings?.nonce||""},body:JSON.stringify(n)});if(!r.ok)throw new Error((0,s.__)("HTTP error! Please try again.","wyverncss"));const i=await r.json();if(!i.success)throw new Error(i.error||(0,s.__)("Failed to send message","wyverncss"));i.data.conversationId&&(u.current=i.data.conversationId);const a={id:`bot-${Date.now()}`,role:"assistant",content:i.data.response,timestamp:new Date};g(e=>[...e,a])}catch(e){const t={id:`error-${Date.now()}`,role:"assistant",content:(0,s.__)("Sorry, there was an error processing your message. Please try again.","wyverncss"),timestamp:new Date,error:!0};g(e=>[...e,t]),console.error("Chat error:",e)}finally{m(!1)}},[e]);return"floating"===n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a,{isOpen:y,onClick:_,theme:r}),y&&(0,i.jsxs)("div",{className:`wyverncss-chat-widget wyverncss-chat-widget--floating wyverncss-chat-widget--${r}`,style:{width:c,height:l},role:"region","aria-label":(0,s.__)("Chat widget","wyverncss"),children:[(0,i.jsxs)("div",{className:"wyverncss-chat-widget__header",children:[(0,i.jsx)("h2",{className:"wyverncss-chat-widget__title",children:(0,s.__)("Chat","wyverncss")}),(0,i.jsx)("button",{type:"button",className:"wyverncss-chat-widget__close",onClick:_,"aria-label":(0,s.__)("Close chat","wyverncss"),children:(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,i.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,i.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,i.jsx)(d,{messages:p,isLoading:x,theme:r}),(0,i.jsx)(o,{onSend:j,disabled:x,placeholder:h,theme:r})]})]}):(0,i.jsxs)("div",{className:`wyverncss-chat-widget wyverncss-chat-widget--inline wyverncss-chat-widget--${r}`,style:{width:c,height:l},role:"region","aria-label":(0,s.__)("Chat widget","wyverncss"),children:[(0,i.jsx)("div",{className:"wyverncss-chat-widget__header",children:(0,i.jsx)("h2",{className:"wyverncss-chat-widget__title",children:(0,s.__)("Chat","wyverncss")})}),(0,i.jsx)(d,{messages:p,isLoading:x,theme:r}),(0,i.jsx)(o,{onSend:j,disabled:x,placeholder:h,theme:r})]})};(0,e.registerBlockType)("wyverncss/chat-bot",{title:(0,s.__)("WyvernCSS Chat Bot","wyverncss"),description:(0,s.__)("Embed an AI-powered chat bot on your page","wyverncss"),category:"wyverncss",icon:"format-chat",attributes:{botId:{type:"string",default:""},position:{type:"string",default:"inline"},theme:{type:"string",default:"light"},width:{type:"number",default:400},height:{type:"number",default:500}},supports:{html:!1,align:["wide","full"]},edit:({attributes:e,setAttributes:t})=>{const{botId:a,position:o,theme:c,width:l,height:d}=e,w=(0,n.useBlockProps)(),y=[{label:(0,s.__)("Inline","wyverncss"),value:"inline"},{label:(0,s.__)("Floating (Bottom Right)","wyverncss"),value:"floating"}],v=[{label:(0,s.__)("Light","wyverncss"),value:"light"},{label:(0,s.__)("Dark","wyverncss"),value:"dark"}];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.InspectorControls,{children:[(0,i.jsxs)(r.PanelBody,{title:(0,s.__)("Bot Settings","wyverncss"),initialOpen:!0,children:[(0,i.jsx)(r.PanelRow,{children:(0,i.jsx)(r.TextControl,{label:(0,s.__)("Bot ID","wyverncss"),help:(0,s.__)("Enter the unique ID of your chat bot","wyverncss"),value:a,onChange:e=>t({botId:e}),placeholder:(0,s.__)("Enter bot ID…","wyverncss")})}),(0,i.jsx)(r.PanelRow,{children:(0,i.jsx)(r.SelectControl,{label:(0,s.__)("Position","wyverncss"),help:(0,s.__)("Choose where the chat bot appears","wyverncss"),value:o,options:y,onChange:e=>t({position:e})})})]}),(0,i.jsxs)(r.PanelBody,{title:(0,s.__)("Appearance","wyverncss"),initialOpen:!1,children:[(0,i.jsx)(r.PanelRow,{children:(0,i.jsx)(r.SelectControl,{label:(0,s.__)("Theme","wyverncss"),value:c,options:v,onChange:e=>t({theme:e})})}),"inline"===o&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.PanelRow,{children:(0,i.jsx)(r.RangeControl,{label:(0,s.__)("Width (px)","wyverncss"),value:l,onChange:e=>t({width:null!=e?e:400}),min:300,max:800,step:10})}),(0,i.jsx)(r.PanelRow,{children:(0,i.jsx)(r.RangeControl,{label:(0,s.__)("Height (px)","wyverncss"),value:d,onChange:e=>t({height:null!=e?e:500}),min:300,max:800,step:10})})]})]})]}),(0,i.jsx)("div",{...w,children:a?"floating"===o?(0,i.jsxs)("div",{className:"wyverncss-chat-bot-placeholder",style:{padding:"20px",border:"2px dashed #ccc",borderRadius:"4px",textAlign:"center",backgroundColor:"#f0f8ff"},children:[(0,i.jsx)("p",{style:{margin:"0 0 10px",fontSize:"16px",fontWeight:"bold"},children:(0,s.__)("WyvernCSS Chat Bot (Floating)","wyverncss")}),(0,i.jsx)("p",{style:{margin:0,color:"#666"},children:(0,s.__)("This chat bot will appear in the bottom-right corner of the page. Preview is not available in the editor.","wyverncss")}),(0,i.jsxs)("p",{style:{margin:"10px 0 0",fontSize:"12px",color:"#999"},children:[(0,s.__)("Bot ID:","wyverncss")," ",(0,i.jsx)("code",{children:a})]})]}):(0,i.jsx)("div",{style:{border:"1px solid #e0e0e0",borderRadius:"4px",overflow:"hidden"},children:(0,i.jsx)(h,{botId:a,position:o,theme:c,width:`${l}px`,height:`${d}px`,placeholder:(0,s.__)("Type your message…","wyverncss"),welcomeMessage:(0,s.__)("Hello! How can I help you today?","wyverncss")})}):(0,i.jsxs)("div",{className:"wyverncss-chat-bot-placeholder",style:{padding:"20px",border:"2px dashed #ccc",borderRadius:"4px",textAlign:"center",backgroundColor:"#f9f9f9"},children:[(0,i.jsx)("p",{style:{margin:"0 0 10px",fontSize:"16px",fontWeight:"bold"},children:(0,s.__)("WyvernCSS Chat Bot","wyverncss")}),(0,i.jsx)("p",{style:{margin:0,color:"#666"},children:(0,s.__)("Please enter a Bot ID in the block settings to display the chat widget.","wyverncss")})]})})]})},save:()=>null})})();