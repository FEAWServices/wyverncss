(()=>{"use strict";const e=window.wp.blocks,s=window.wp.i18n,t=window.React,n=window.wp.blockEditor,i=window.wp.components,a=window.ReactJSXRuntime,r=({isOpen:e,onClick:t,theme:n})=>(0,a.jsx)("button",{type:"button",className:`wyverncss-chat-bubble wyverncss-chat-bubble--${n}`,onClick:t,"aria-label":e?(0,s.__)("Close chat","wyvern-ai-styling"):(0,s.__)("Open chat","wyvern-ai-styling"),"aria-expanded":e,children:e?(0,a.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}):(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),l=({onSend:e,disabled:n,placeholder:i=(0,s.__)("Type your message…","wyvern-ai-styling"),theme:r})=>{const[l,o]=(0,t.useState)(""),c=(0,t.useCallback)(()=>{l.trim()&&!n&&(e(l.trim()),o(""))},[l,n,e]),d=(0,t.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},[c]),h=0===l.trim().length;return(0,a.jsxs)("div",{className:`wyverncss-chat-input wyverncss-chat-input--${r}`,children:[(0,a.jsx)("label",{htmlFor:"wyverncss-message-input",className:"wyverncss-chat-input__label",children:(0,s.__)("Message","wyvern-ai-styling")}),(0,a.jsxs)("div",{className:"wyverncss-chat-input__wrapper",children:[(0,a.jsx)("textarea",{id:"wyverncss-message-input",className:"wyverncss-chat-input__field",value:l,onChange:e=>o(e.target.value),onKeyPress:d,placeholder:i,disabled:n,"aria-label":(0,s.__)("Message","wyvern-ai-styling"),rows:1}),(0,a.jsxs)("button",{type:"button",className:"wyverncss-chat-input__button",onClick:c,disabled:n||h,"aria-label":(0,s.__)("Send message","wyvern-ai-styling"),children:[(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,a.jsx)("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),(0,a.jsx)("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),(0,a.jsx)("span",{className:"wyverncss-chat-input__button-text",children:(0,s.__)("Send","wyvern-ai-styling")})]})]})]})},o=({message:e,theme:t})=>{const n="user"===e.role,i=!0===e.error;return(0,a.jsxs)("div",{className:`wyverncss-message wyverncss-message--${e.role} wyverncss-message--${t}${i?" wyverncss-message--error":""}`,role:"article","aria-label":n?(0,s.__)("Your message","wyvern-ai-styling"):(0,s.__)("Assistant message","wyvern-ai-styling"),children:[(0,a.jsx)("div",{className:"wyverncss-message__avatar","aria-hidden":"true",children:n?(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),(0,a.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}):(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,a.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),(0,a.jsxs)("div",{className:"wyverncss-message__content",children:[(0,a.jsx)("p",{className:"wyverncss-message__text",children:e.content}),(0,a.jsx)("time",{className:"wyverncss-message__timestamp",dateTime:e.timestamp.toISOString(),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},c=({theme:e})=>(0,a.jsxs)("div",{className:`wyverncss-typing-indicator wyverncss-typing-indicator--${e}`,role:"status","aria-live":"polite",children:[(0,a.jsx)("div",{className:"wyverncss-typing-indicator__avatar","aria-hidden":"true",children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),(0,a.jsx)("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),(0,a.jsxs)("div",{className:"wyverncss-typing-indicator__content",children:[(0,a.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,a.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,a.jsx)("span",{className:"wyverncss-typing-indicator__dot","aria-hidden":"true"}),(0,a.jsx)("span",{className:"wyverncss-sr-only",children:(0,s.__)("Assistant is typing","wyvern-ai-styling")})]})]}),d=({messages:e,isLoading:n,theme:i})=>{const r=(0,t.useRef)(null);return(0,t.useEffect)(()=>{r.current&&"function"==typeof r.current.scrollIntoView&&r.current.scrollIntoView({behavior:"smooth"})},[e,n]),(0,a.jsx)("div",{className:`wyverncss-message-list wyverncss-message-list--${i}`,children:0!==e.length||n?(0,a.jsxs)(a.Fragment,{children:[e.map(e=>(0,a.jsx)(o,{message:e,theme:i},e.id)),n&&(0,a.jsx)(c,{theme:i}),(0,a.jsx)("div",{ref:r,"aria-hidden":"true"})]}):(0,a.jsx)("div",{className:"wyverncss-message-list__empty",role:"status","aria-live":"polite",children:(0,a.jsx)("p",{children:(0,s.__)("Start a conversation by typing a message below.","wyvern-ai-styling")})})})},h=({botId:e,position:n,theme:i,width:o="400px",height:c="500px",placeholder:h=(0,s.__)("Type your message…","wyvern-ai-styling"),welcomeMessage:y})=>{const[g,w]=(0,t.useState)("inline"===n),[v,p]=(0,t.useState)([]),[x,m]=(0,t.useState)(!1),u=(0,t.useRef)(void 0);(0,t.useEffect)(()=>{if(y&&0===v.length){const e={id:`welcome-${Date.now()}`,role:"assistant",content:y,timestamp:new Date};p([e])}},[y,v.length]);const _=(0,t.useCallback)(()=>{w(e=>!e)},[]),j=(0,t.useCallback)(async t=>{const n={id:`user-${Date.now()}`,role:"user",content:t,timestamp:new Date};p(e=>[...e,n]),m(!0);try{const n={message:t,botId:e,conversationId:u.current},i=await fetch("/wp-json/wyvernpress/v1/chat",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.wyverncssApiSettings?.nonce||""},body:JSON.stringify(n)});if(!i.ok)throw new Error((0,s.__)("HTTP error! Please try again.","wyvern-ai-styling"));const a=await i.json();if(!a.success)throw new Error(a.error||(0,s.__)("Failed to send message","wyvern-ai-styling"));a.data.conversationId&&(u.current=a.data.conversationId);const r={id:`bot-${Date.now()}`,role:"assistant",content:a.data.response,timestamp:new Date};p(e=>[...e,r])}catch(e){const t={id:`error-${Date.now()}`,role:"assistant",content:(0,s.__)("Sorry, there was an error processing your message. Please try again.","wyvern-ai-styling"),timestamp:new Date,error:!0};p(e=>[...e,t]),console.error("Chat error:",e)}finally{m(!1)}},[e]);return"floating"===n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r,{isOpen:g,onClick:_,theme:i}),g&&(0,a.jsxs)("div",{className:`wyverncss-chat-widget wyverncss-chat-widget--floating wyverncss-chat-widget--${i}`,style:{width:o,height:c},role:"region","aria-label":(0,s.__)("Chat widget","wyvern-ai-styling"),children:[(0,a.jsxs)("div",{className:"wyverncss-chat-widget__header",children:[(0,a.jsx)("h2",{className:"wyverncss-chat-widget__title",children:(0,s.__)("Chat","wyvern-ai-styling")}),(0,a.jsx)("button",{type:"button",className:"wyverncss-chat-widget__close",onClick:_,"aria-label":(0,s.__)("Close chat","wyvern-ai-styling"),children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,a.jsx)(d,{messages:v,isLoading:x,theme:i}),(0,a.jsx)(l,{onSend:j,disabled:x,placeholder:h,theme:i})]})]}):(0,a.jsxs)("div",{className:`wyverncss-chat-widget wyverncss-chat-widget--inline wyverncss-chat-widget--${i}`,style:{width:o,height:c},role:"region","aria-label":(0,s.__)("Chat widget","wyvern-ai-styling"),children:[(0,a.jsx)("div",{className:"wyverncss-chat-widget__header",children:(0,a.jsx)("h2",{className:"wyverncss-chat-widget__title",children:(0,s.__)("Chat","wyvern-ai-styling")})}),(0,a.jsx)(d,{messages:v,isLoading:x,theme:i}),(0,a.jsx)(l,{onSend:j,disabled:x,placeholder:h,theme:i})]})};(0,e.registerBlockType)("wyverncss/chat-bot",{title:(0,s.__)("WyvernCSS Chat Bot","wyvern-ai-styling"),description:(0,s.__)("Embed an AI-powered chat bot on your page","wyvern-ai-styling"),category:"wyvern-ai-styling",icon:"format-chat",attributes:{botId:{type:"string",default:""},position:{type:"string",default:"inline"},theme:{type:"string",default:"light"},width:{type:"number",default:400},height:{type:"number",default:500}},supports:{html:!1,align:["wide","full"]},edit:({attributes:e,setAttributes:t})=>{const{botId:r,position:l,theme:o,width:c,height:d}=e,y=(0,n.useBlockProps)(),g=[{label:(0,s.__)("Inline","wyvern-ai-styling"),value:"inline"},{label:(0,s.__)("Floating (Bottom Right)","wyvern-ai-styling"),value:"floating"}],w=[{label:(0,s.__)("Light","wyvern-ai-styling"),value:"light"},{label:(0,s.__)("Dark","wyvern-ai-styling"),value:"dark"}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.InspectorControls,{children:[(0,a.jsxs)(i.PanelBody,{title:(0,s.__)("Bot Settings","wyvern-ai-styling"),initialOpen:!0,children:[(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.TextControl,{label:(0,s.__)("Bot ID","wyvern-ai-styling"),help:(0,s.__)("Enter the unique ID of your chat bot","wyvern-ai-styling"),value:r,onChange:e=>t({botId:e}),placeholder:(0,s.__)("Enter bot ID…","wyvern-ai-styling")})}),(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.SelectControl,{label:(0,s.__)("Position","wyvern-ai-styling"),help:(0,s.__)("Choose where the chat bot appears","wyvern-ai-styling"),value:l,options:g,onChange:e=>t({position:e})})})]}),(0,a.jsxs)(i.PanelBody,{title:(0,s.__)("Appearance","wyvern-ai-styling"),initialOpen:!1,children:[(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.SelectControl,{label:(0,s.__)("Theme","wyvern-ai-styling"),value:o,options:w,onChange:e=>t({theme:e})})}),"inline"===l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.RangeControl,{label:(0,s.__)("Width (px)","wyvern-ai-styling"),value:c,onChange:e=>t({width:null!=e?e:400}),min:300,max:800,step:10})}),(0,a.jsx)(i.PanelRow,{children:(0,a.jsx)(i.RangeControl,{label:(0,s.__)("Height (px)","wyvern-ai-styling"),value:d,onChange:e=>t({height:null!=e?e:500}),min:300,max:800,step:10})})]})]})]}),(0,a.jsx)("div",{...y,children:r?"floating"===l?(0,a.jsxs)("div",{className:"wyverncss-chat-bot-placeholder",style:{padding:"20px",border:"2px dashed #ccc",borderRadius:"4px",textAlign:"center",backgroundColor:"#f0f8ff"},children:[(0,a.jsx)("p",{style:{margin:"0 0 10px",fontSize:"16px",fontWeight:"bold"},children:(0,s.__)("WyvernCSS Chat Bot (Floating)","wyvern-ai-styling")}),(0,a.jsx)("p",{style:{margin:0,color:"#666"},children:(0,s.__)("This chat bot will appear in the bottom-right corner of the page. Preview is not available in the editor.","wyvern-ai-styling")}),(0,a.jsxs)("p",{style:{margin:"10px 0 0",fontSize:"12px",color:"#999"},children:[(0,s.__)("Bot ID:","wyvern-ai-styling")," ",(0,a.jsx)("code",{children:r})]})]}):(0,a.jsx)("div",{style:{border:"1px solid #e0e0e0",borderRadius:"4px",overflow:"hidden"},children:(0,a.jsx)(h,{botId:r,position:l,theme:o,width:`${c}px`,height:`${d}px`,placeholder:(0,s.__)("Type your message…","wyvern-ai-styling"),welcomeMessage:(0,s.__)("Hello! How can I help you today?","wyvern-ai-styling")})}):(0,a.jsxs)("div",{className:"wyverncss-chat-bot-placeholder",style:{padding:"20px",border:"2px dashed #ccc",borderRadius:"4px",textAlign:"center",backgroundColor:"#f9f9f9"},children:[(0,a.jsx)("p",{style:{margin:"0 0 10px",fontSize:"16px",fontWeight:"bold"},children:(0,s.__)("WyvernCSS Chat Bot","wyvern-ai-styling")}),(0,a.jsx)("p",{style:{margin:0,color:"#666"},children:(0,s.__)("Please enter a Bot ID in the block settings to display the chat widget.","wyvern-ai-styling")})]})})]})},save:()=>null})})();